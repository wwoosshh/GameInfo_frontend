<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ê²Œì„ ì—…ë°ì´íŠ¸ ì •ë³´ë¥¼ í•œëˆˆì— í™•ì¸í•˜ì„¸ìš”">
    <title>GameInfo - ê²Œì„ ì •ë³´ íŠ¸ë˜ì»¤</title>
    <link rel="stylesheet" href="../css/main.css">
    <style>
        /* ê²€ìƒ‰ ì„¹ì…˜ */
        .search-section {
            margin-bottom: 48px;
        }

        .search-container {
            position: relative;
            max-width: 600px;
            margin: 0 auto;
        }

        .search-input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }

        .search-input {
            width: 100%;
            padding: 16px 20px;
            padding-right: 50px;
            font-size: 16px;
            background: var(--bg-secondary);
            border: 2px solid var(--divider);
            border-radius: 12px;
            color: var(--text-primary);
            transition: var(--transition);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--accent-blue);
            background: var(--bg-primary);
        }

        .search-input::placeholder {
            color: var(--text-muted);
        }

        .search-icon {
            position: absolute;
            right: 16px;
            color: var(--text-muted);
            font-size: 20px;
            pointer-events: none;
        }

        .search-clear {
            position: absolute;
            right: 45px;
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 18px;
            cursor: pointer;
            padding: 4px;
            display: none;
        }

        .search-clear.show {
            display: block;
        }

        .search-clear:hover {
            color: var(--text-primary);
        }

        /* ìë™ì™„ì„± ë“œë¡­ë‹¤ìš´ */
        .autocomplete-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--bg-secondary);
            border: 1px solid var(--divider);
            border-top: none;
            border-radius: 0 0 12px 12px;
            max-height: 400px;
            overflow-y: auto;
            z-index: 100;
            display: none;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .autocomplete-dropdown.show {
            display: block;
        }

        .autocomplete-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            cursor: pointer;
            transition: var(--transition);
            border-bottom: 1px solid var(--divider);
        }

        .autocomplete-item:last-child {
            border-bottom: none;
        }

        .autocomplete-item:hover,
        .autocomplete-item.selected {
            background: var(--bg-hover);
        }

        .autocomplete-item-icon {
            width: 32px;
            height: 32px;
            border-radius: 6px;
            object-fit: cover;
            background: var(--bg-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            color: var(--text-muted);
            flex-shrink: 0;
        }

        .autocomplete-item-icon img {
            width: 100%;
            height: 100%;
            border-radius: 6px;
            object-fit: cover;
        }

        .autocomplete-item-content {
            flex: 1;
            min-width: 0;
        }

        .autocomplete-item-text {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .autocomplete-item-text mark {
            background: rgba(96, 165, 250, 0.3);
            color: var(--accent-blue);
            padding: 0 2px;
            border-radius: 2px;
        }

        .autocomplete-item-subtext {
            font-size: 12px;
            color: var(--text-muted);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .autocomplete-item-type {
            font-size: 11px;
            padding: 2px 8px;
            border-radius: 4px;
            background: var(--bg-primary);
            color: var(--text-muted);
            flex-shrink: 0;
        }

        .autocomplete-item-type.game {
            background: rgba(96, 165, 250, 0.2);
            color: var(--accent-blue);
        }

        .autocomplete-item-type.version {
            background: rgba(52, 211, 153, 0.2);
            color: var(--accent-green);
        }

        .autocomplete-item-type.item {
            background: rgba(251, 191, 36, 0.2);
            color: var(--accent-yellow);
        }

        .autocomplete-hint {
            padding: 8px 16px;
            font-size: 11px;
            color: var(--text-muted);
            background: var(--bg-primary);
            border-top: 1px solid var(--divider);
        }

        /* ê²€ìƒ‰ ê²°ê³¼ */
        .search-results {
            margin-top: 32px;
            display: none;
        }

        .search-results.show {
            display: block;
        }

        .search-results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--divider);
        }

        .search-results-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .search-results-count {
            font-size: 14px;
            color: var(--text-muted);
        }

        .search-results-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        /* ê²€ìƒ‰ ê²°ê³¼ ì¹´ë“œ (ë²„ì „ ì¹´ë“œ) */
        .version-card {
            background: var(--bg-secondary);
            border: 1px solid var(--divider);
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: var(--transition);
        }

        .version-card:hover {
            border-color: var(--accent-blue);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .version-card-header {
            display: flex;
            gap: 16px;
            margin-bottom: 12px;
        }

        .version-card-thumbnail {
            width: 80px;
            height: 80px;
            border-radius: 8px;
            object-fit: cover;
            background: var(--bg-primary);
            flex-shrink: 0;
        }

        .version-card-info {
            flex: 1;
            min-width: 0;
        }

        .version-card-game {
            font-size: 12px;
            color: var(--accent-blue);
            font-weight: 500;
            margin-bottom: 4px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .version-card-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .version-card-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .version-card-date {
            font-size: 13px;
            color: var(--text-muted);
        }

        .version-card-date.current {
            color: var(--accent-green);
        }

        /* ë§¤ì¹­ëœ í•­ëª©ë“¤ */
        .matched-items {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--divider);
        }

        .matched-item {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 10px;
            background: var(--bg-primary);
            border-radius: 6px;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .matched-item-icon {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            object-fit: cover;
        }

        .matched-item-more {
            padding: 6px 10px;
            background: rgba(96, 165, 250, 0.1);
            border-radius: 6px;
            font-size: 12px;
            color: var(--accent-blue);
        }

        /* ê²€ìƒ‰ ì¤‘ ë¡œë”© */
        .search-loading {
            text-align: center;
            padding: 40px;
            color: var(--text-muted);
        }

        /* ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ */
        .search-empty {
            text-align: center;
            padding: 60px 20px;
        }

        .search-empty h3 {
            font-size: 18px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .search-empty p {
            font-size: 14px;
            color: var(--text-muted);
        }

        /* í˜ì´ì§€ë„¤ì´ì…˜ */
        .search-pagination {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 24px;
        }

        .search-pagination button {
            padding: 8px 16px;
            background: var(--bg-secondary);
            border: 1px solid var(--divider);
            border-radius: 6px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition);
        }

        .search-pagination button:hover:not(:disabled) {
            background: var(--bg-hover);
            color: var(--text-primary);
        }

        .search-pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* ì¸ê¸° ê²Œì„ ì„¹ì…˜ */
        .games-section {
            margin-top: 48px;
        }

        @media (max-width: 768px) {
            .search-input {
                padding: 14px 16px;
                font-size: 15px;
            }

            .version-card-header {
                flex-direction: column;
            }

            .version-card-thumbnail {
                width: 100%;
                height: 120px;
            }
        }
    </style>
</head>
<body>
    <!-- í—¤ë” -->
    <header class="main-header">
        <div class="container">
            <div class="header-content">
                <h1 class="site-title">
                    <a href="index.html">GameInfo</a>
                </h1>
                <nav class="main-nav">
                    <ul>
                        <li><a href="index.html">í™ˆ</a></li>
                        <li><a href="calendar.html">ìº˜ë¦°ë”</a></li>
                        <li><a href="games.html">ê²Œì„ ëª©ë¡</a></li>
                        <li id="nav-community"><a href="community.html">ì»¤ë®¤ë‹ˆí‹°</a></li>
                        <li id="nav-admin" style="display:none;"><a href="admin.html">ê´€ë¦¬ì</a></li>
                        <li id="nav-profile" style="display:none;"><a href="profile.html">í”„ë¡œí•„</a></li>
                        <li id="nav-login"><a href="login.html">ë¡œê·¸ì¸</a></li>
                        <li id="nav-logout" style="display:none;"><a href="#" onclick="handleLogout(event)">ë¡œê·¸ì•„ì›ƒ</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <!-- ë©”ì¸ ì»¨í…ì¸  -->
    <main class="main-content">
        <div class="container">
            <!-- í™˜ì˜ ì„¹ì…˜ -->
            <section class="welcome-section">
                <h2>ê²Œì„ ë²„ì „ ê²€ìƒ‰</h2>
                <p>ê²Œì„, ë²„ì „, ìºë¦­í„°, ì•„ì´í…œ ë“±ì„ ê²€ìƒ‰í•´ë³´ì„¸ìš”</p>
            </section>

            <!-- ê²€ìƒ‰ ì„¹ì…˜ -->
            <section class="search-section">
                <div class="search-container">
                    <div class="search-input-wrapper">
                        <input
                            type="text"
                            id="search-input"
                            class="search-input"
                            placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”... (ê²Œì„, ë²„ì „, ìºë¦­í„°, ì•„ì´í…œ, ì´ˆì„±ê²€ìƒ‰ ì§€ì›)"
                            autocomplete="off"
                        >
                        <button id="search-clear" class="search-clear">&times;</button>
                        <span class="search-icon">&#128269;</span>

                        <!-- ìë™ì™„ì„± ë“œë¡­ë‹¤ìš´ -->
                        <div id="autocomplete-dropdown" class="autocomplete-dropdown">
                            <div id="autocomplete-list"></div>
                            <div class="autocomplete-hint">â†‘â†“ ì´ë™ Â· Enter ì„ íƒ Â· Esc ë‹«ê¸° Â· ì´ˆì„±ê²€ìƒ‰ ì§€ì› (ã„±ã„´ã„·)</div>
                        </div>
                    </div>
                </div>

                <!-- ê²€ìƒ‰ ê²°ê³¼ -->
                <div id="search-results" class="search-results">
                    <div class="search-results-header">
                        <span class="search-results-title">ê²€ìƒ‰ ê²°ê³¼</span>
                        <span id="search-results-count" class="search-results-count"></span>
                    </div>
                    <div id="search-results-list" class="search-results-list">
                        <!-- ê²€ìƒ‰ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                    </div>
                    <div id="search-pagination" class="search-pagination"></div>
                </div>
            </section>

            <!-- ê²Œì„ ëª©ë¡ -->
            <section class="games-section">
                <div class="section-header">
                    <h3>ì¸ê¸° ê²Œì„</h3>
                    <a href="games.html" class="view-all">ì „ì²´ ë³´ê¸° &rarr;</a>
                </div>

                <div id="games-list" class="games-grid">
                    <!-- JavaScriptë¡œ ë™ì  ë¡œë“œ -->
                    <div class="loading">ë¡œë”© ì¤‘...</div>
                </div>
            </section>
        </div>
    </main>

    <!-- í‘¸í„° -->
    <footer class="main-footer">
        <div class="container">
            <p>&copy; 2025 GameInfo. ëŒ€í•™êµ ê³¼ì œ í”„ë¡œì íŠ¸</p>
            <p>ëª¨ë“  ê²Œì„ ê´€ë ¨ ìƒí‘œëŠ” í•´ë‹¹ ì†Œìœ ìì˜ ìì‚°ì…ë‹ˆë‹¤.</p>
        </div>
    </footer>

    <!-- JavaScript -->
    <script src="../js/api.js?v=2"></script>
    <script src="../js/navigation.js"></script>
    <script>
        // ê²€ìƒ‰ ê´€ë ¨ ë³€ìˆ˜
        let searchTimeout = null;
        let autocompleteTimeout = null;
        let currentSearchQuery = '';
        let currentSearchPage = 1;
        let selectedAutocompleteIndex = -1;
        let autocompleteResults = [];

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            loadGames();
            initSearch();
        });

        // ê²€ìƒ‰ ì´ˆê¸°í™”
        function initSearch() {
            const searchInput = document.getElementById('search-input');
            const searchClear = document.getElementById('search-clear');
            const autocompleteDropdown = document.getElementById('autocomplete-dropdown');

            // ì…ë ¥ ì´ë²¤íŠ¸ (ë””ë°”ìš´ì‹± ì ìš©)
            searchInput.addEventListener('input', (e) => {
                const query = e.target.value.trim();

                // í´ë¦¬ì–´ ë²„íŠ¼ í‘œì‹œ/ìˆ¨ê¹€
                searchClear.classList.toggle('show', query.length > 0);

                // ìë™ì™„ì„± ì´ˆê¸°í™”
                selectedAutocompleteIndex = -1;

                // ë””ë°”ìš´ì‹±: 150ms í›„ì— ìë™ì™„ì„± ì‹¤í–‰
                clearTimeout(autocompleteTimeout);
                clearTimeout(searchTimeout);

                if (query.length === 0) {
                    hideAutocomplete();
                    hideSearchResults();
                    return;
                }

                // ìë™ì™„ì„± (ë” ë¹ ë¥´ê²Œ)
                autocompleteTimeout = setTimeout(() => {
                    fetchAutocomplete(query);
                }, 150);
            });

            // í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜
            searchInput.addEventListener('keydown', (e) => {
                const isDropdownVisible = autocompleteDropdown.classList.contains('show');

                if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    if (isDropdownVisible && autocompleteResults.length > 0) {
                        selectedAutocompleteIndex = Math.min(selectedAutocompleteIndex + 1, autocompleteResults.length - 1);
                        updateAutocompleteSelection();
                    }
                } else if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    if (isDropdownVisible && autocompleteResults.length > 0) {
                        selectedAutocompleteIndex = Math.max(selectedAutocompleteIndex - 1, -1);
                        updateAutocompleteSelection();
                    }
                } else if (e.key === 'Enter') {
                    e.preventDefault();
                    if (isDropdownVisible && selectedAutocompleteIndex >= 0) {
                        // ì„ íƒëœ ìë™ì™„ì„± í•­ëª© í´ë¦­
                        selectAutocompleteItem(autocompleteResults[selectedAutocompleteIndex]);
                    } else {
                        // ì¼ë°˜ ê²€ìƒ‰ ì‹¤í–‰
                        clearTimeout(searchTimeout);
                        clearTimeout(autocompleteTimeout);
                        hideAutocomplete();
                        const query = searchInput.value.trim();
                        if (query.length > 0) {
                            performSearch(query, 1);
                        }
                    }
                } else if (e.key === 'Escape') {
                    hideAutocomplete();
                }
            });

            // í¬ì»¤ìŠ¤ ì•„ì›ƒ ì‹œ ìë™ì™„ì„± ë‹«ê¸° (ì•½ê°„ì˜ ë”œë ˆì´)
            searchInput.addEventListener('blur', () => {
                setTimeout(() => {
                    hideAutocomplete();
                }, 200);
            });

            // í´ë¦¬ì–´ ë²„íŠ¼
            searchClear.addEventListener('click', () => {
                searchInput.value = '';
                searchClear.classList.remove('show');
                hideAutocomplete();
                hideSearchResults();
                searchInput.focus();
            });

            // ë¬¸ì„œ í´ë¦­ ì‹œ ìë™ì™„ì„± ë‹«ê¸°
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.search-container')) {
                    hideAutocomplete();
                }
            });
        }

        // ìë™ì™„ì„± API í˜¸ì¶œ
        async function fetchAutocomplete(query) {
            try {
                const response = await API.search.autocomplete(query, 8);

                if (response.success) {
                    autocompleteResults = response.data.suggestions;
                    displayAutocomplete(autocompleteResults, query, response.data.is_chosung);
                }
            } catch (error) {
                console.error('Autocomplete error:', error);
                hideAutocomplete();
            }
        }

        // ìë™ì™„ì„± ê²°ê³¼ í‘œì‹œ
        function displayAutocomplete(suggestions, query, isChosung) {
            const dropdown = document.getElementById('autocomplete-dropdown');
            const list = document.getElementById('autocomplete-list');

            if (suggestions.length === 0) {
                hideAutocomplete();
                return;
            }

            const typeNames = {
                'game': 'ê²Œì„',
                'version': 'ë²„ì „',
                'item': 'í•­ëª©'
            };

            const typeIcons = {
                'game': 'ğŸ®',
                'version': 'ğŸ“¦',
                'item': 'â­'
            };

            list.innerHTML = suggestions.map((item, index) => {
                // ê²€ìƒ‰ì–´ í•˜ì´ë¼ì´íŠ¸
                const highlightedText = highlightMatch(item.text, query, isChosung);

                // ì•„ì´ì½˜
                let iconHtml = '';
                if (item.icon) {
                    iconHtml = `<img src="${item.icon}" alt="">`;
                } else {
                    iconHtml = typeIcons[item.type] || 'ğŸ“„';
                }

                return `
                    <div class="autocomplete-item ${index === selectedAutocompleteIndex ? 'selected' : ''}"
                         data-index="${index}"
                         onmousedown="selectAutocompleteItem(autocompleteResults[${index}])">
                        <div class="autocomplete-item-icon">${iconHtml}</div>
                        <div class="autocomplete-item-content">
                            <div class="autocomplete-item-text">${highlightedText}</div>
                            ${item.subtext ? `<div class="autocomplete-item-subtext">${escapeHtml(item.subtext)}</div>` : ''}
                        </div>
                        <span class="autocomplete-item-type ${item.type}">${typeNames[item.type] || item.type}</span>
                    </div>
                `;
            }).join('');

            dropdown.classList.add('show');
        }

        // ê²€ìƒ‰ì–´ í•˜ì´ë¼ì´íŠ¸
        function highlightMatch(text, query, isChosung) {
            if (!text || !query) return escapeHtml(text);

            const escapedText = escapeHtml(text);

            if (isChosung) {
                // ì´ˆì„± ê²€ìƒ‰ì˜ ê²½ìš° ì›ë³¸ í…ìŠ¤íŠ¸ ê·¸ëŒ€ë¡œ í‘œì‹œ (í•˜ì´ë¼ì´íŠ¸ ì—†ìŒ)
                return escapedText;
            }

            // ëŒ€ì†Œë¬¸ì ë¬´ì‹œ ë§¤ì¹­
            const lowerText = text.toLowerCase();
            const lowerQuery = query.toLowerCase();
            const index = lowerText.indexOf(lowerQuery);

            if (index === -1) return escapedText;

            const before = escapeHtml(text.substring(0, index));
            const match = escapeHtml(text.substring(index, index + query.length));
            const after = escapeHtml(text.substring(index + query.length));

            return `${before}<mark>${match}</mark>${after}`;
        }

        // ìë™ì™„ì„± ì„ íƒ ì—…ë°ì´íŠ¸
        function updateAutocompleteSelection() {
            const items = document.querySelectorAll('.autocomplete-item');
            items.forEach((item, index) => {
                item.classList.toggle('selected', index === selectedAutocompleteIndex);
            });

            // ì„ íƒëœ í•­ëª©ì´ ë³´ì´ë„ë¡ ìŠ¤í¬ë¡¤
            if (selectedAutocompleteIndex >= 0) {
                items[selectedAutocompleteIndex]?.scrollIntoView({ block: 'nearest' });
            }
        }

        // ìë™ì™„ì„± í•­ëª© ì„ íƒ
        function selectAutocompleteItem(item) {
            const searchInput = document.getElementById('search-input');

            hideAutocomplete();

            if (item.type === 'game') {
                // ê²Œì„ ì„ íƒ ì‹œ í•´ë‹¹ ê²Œì„ì˜ ë²„ì „ ëª©ë¡ìœ¼ë¡œ ì´ë™
                window.location.href = `game_versions.html?game_id=${item.id}`;
            } else if (item.type === 'version') {
                // ë²„ì „ ì„ íƒ ì‹œ ë²„ì „ ìƒì„¸ë¡œ ì´ë™
                window.location.href = `version_detail.html?version_id=${item.id}`;
            } else if (item.type === 'item') {
                // í•­ëª© ì„ íƒ ì‹œ í•´ë‹¹ ë²„ì „ìœ¼ë¡œ ì´ë™
                window.location.href = `version_detail.html?version_id=${item.version_id}`;
            } else {
                // ê¸°ë³¸: ê²€ìƒ‰ ì‹¤í–‰
                searchInput.value = item.text;
                performSearch(item.text, 1);
            }
        }

        // ìë™ì™„ì„± ìˆ¨ê¸°ê¸°
        function hideAutocomplete() {
            document.getElementById('autocomplete-dropdown').classList.remove('show');
            selectedAutocompleteIndex = -1;
        }

        // ê²€ìƒ‰ ì‹¤í–‰
        async function performSearch(query, page = 1) {
            currentSearchQuery = query;
            currentSearchPage = page;

            const resultsContainer = document.getElementById('search-results');
            const resultsList = document.getElementById('search-results-list');
            const resultsCount = document.getElementById('search-results-count');

            // ê²€ìƒ‰ ê²°ê³¼ ì˜ì—­ í‘œì‹œ
            resultsContainer.classList.add('show');
            resultsList.innerHTML = '<div class="search-loading">ê²€ìƒ‰ ì¤‘...</div>';

            try {
                const response = await API.search.query(query, { page, limit: 10 });

                if (response.success) {
                    const { versions, pagination } = response.data;

                    resultsCount.textContent = `${pagination.total_items}ê°œì˜ ë²„ì „`;

                    if (versions.length === 0) {
                        resultsList.innerHTML = `
                            <div class="search-empty">
                                <h3>"${escapeHtml(query)}"ì— ëŒ€í•œ ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
                                <p>ë‹¤ë¥¸ ê²€ìƒ‰ì–´ë¡œ ì‹œë„í•´ë³´ì„¸ìš”</p>
                            </div>
                        `;
                        document.getElementById('search-pagination').innerHTML = '';
                        return;
                    }

                    // ê²€ìƒ‰ ê²°ê³¼ í‘œì‹œ
                    resultsList.innerHTML = versions.map(version => createVersionCard(version)).join('');

                    // í˜ì´ì§€ë„¤ì´ì…˜
                    displaySearchPagination(pagination);
                } else {
                    resultsList.innerHTML = '<div class="search-empty"><h3>ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤</h3></div>';
                }
            } catch (error) {
                console.error('Search error:', error);
                resultsList.innerHTML = '<div class="search-empty"><h3>ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤</h3></div>';
            }
        }

        // ë²„ì „ ì¹´ë“œ ìƒì„±
        function createVersionCard(version) {
            const thumbnail = version.thumbnail_url || version.banner_image_url || version.game_thumbnail_url || '';
            const releaseDate = version.release_date ? formatDate(version.release_date) : 'ë‚ ì§œ ë¯¸ì •';
            const isCurrentBadge = version.is_current ? '<span class="version-card-date current">í˜„ì¬ ë²„ì „</span>' : '';

            // ë§¤ì¹­ëœ í•­ëª©ë“¤
            let matchedItemsHtml = '';
            if (version.matched_items && version.matched_items.length > 0) {
                const items = version.matched_items.map(item => `
                    <div class="matched-item">
                        ${item.icon_url ? `<img src="${item.icon_url}" class="matched-item-icon" alt="">` : ''}
                        <span>${escapeHtml(item.item_name)}</span>
                    </div>
                `).join('');

                const moreCount = version.matched_items_count - version.matched_items.length;
                const moreHtml = moreCount > 0 ? `<div class="matched-item-more">+${moreCount}ê°œ ë”</div>` : '';

                matchedItemsHtml = `
                    <div class="matched-items">
                        ${items}
                        ${moreHtml}
                    </div>
                `;
            }

            return `
                <div class="version-card" onclick="goToVersion(${version.version_id})">
                    <div class="version-card-header">
                        ${thumbnail ? `<img src="${thumbnail}" class="version-card-thumbnail" alt="">` : '<div class="version-card-thumbnail"></div>'}
                        <div class="version-card-info">
                            <div class="version-card-game">${escapeHtml(version.game_name)}</div>
                            <div class="version-card-title">ë²„ì „ ${escapeHtml(version.version_number)}</div>
                            ${version.version_name ? `<div class="version-card-subtitle">${escapeHtml(version.version_name)}</div>` : ''}
                            <div class="version-card-date">${releaseDate} ${isCurrentBadge}</div>
                        </div>
                    </div>
                    ${matchedItemsHtml}
                </div>
            `;
        }

        // ê²€ìƒ‰ í˜ì´ì§€ë„¤ì´ì…˜
        function displaySearchPagination(pagination) {
            const paginationEl = document.getElementById('search-pagination');
            const { current_page, total_pages } = pagination;

            if (total_pages <= 1) {
                paginationEl.innerHTML = '';
                return;
            }

            paginationEl.innerHTML = `
                <button onclick="performSearch('${escapeHtml(currentSearchQuery)}', ${current_page - 1})" ${current_page === 1 ? 'disabled' : ''}>ì´ì „</button>
                <span style="padding: 8px 12px; color: var(--text-muted);">í˜ì´ì§€ ${current_page} / ${total_pages}</span>
                <button onclick="performSearch('${escapeHtml(currentSearchQuery)}', ${current_page + 1})" ${current_page === total_pages ? 'disabled' : ''}>ë‹¤ìŒ</button>
            `;
        }

        // ê²€ìƒ‰ ê²°ê³¼ ìˆ¨ê¸°ê¸°
        function hideSearchResults() {
            document.getElementById('search-results').classList.remove('show');
        }

        // ë²„ì „ ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™
        function goToVersion(versionId) {
            window.location.href = `version_detail.html?version_id=${versionId}`;
        }

        // ê²Œì„ ëª©ë¡ ë¡œë“œ
        async function loadGames() {
            const gamesList = document.getElementById('games-list');

            try {
                const response = await API.games.getAll({ limit: 6 });

                if (response.success && response.data.games) {
                    displayGames(response.data.games);
                } else {
                    gamesList.innerHTML = '<div class="empty-state"><p>ê²Œì„ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p></div>';
                }
            } catch (error) {
                console.error('Failed to load games:', error);
                gamesList.innerHTML = '<div class="empty-state"><p>ê²Œì„ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p></div>';
            }
        }

        // ê²Œì„ ëª©ë¡ í‘œì‹œ
        function displayGames(games) {
            const gamesList = document.getElementById('games-list');

            if (games.length === 0) {
                gamesList.innerHTML = '<div class="empty-state"><p>ë“±ë¡ëœ ê²Œì„ì´ ì—†ìŠµë‹ˆë‹¤.</p></div>';
                return;
            }

            gamesList.innerHTML = games.map(game => `
                <div class="game-card" onclick="window.location.href='game_versions.html?game_id=${game.game_id}'">
                    ${game.thumbnail_url
                        ? `<img src="${game.thumbnail_url}" alt="${escapeHtml(game.game_name)}" class="game-thumbnail">`
                        : '<div class="game-thumbnail-placeholder">No Image</div>'
                    }
                    <div class="game-info">
                        <h4 class="game-name">${escapeHtml(game.game_name)}</h4>
                        ${game.developer ? `<p class="game-developer">${escapeHtml(game.developer)}</p>` : ''}
                        ${game.genre ? `<span class="game-genre">${escapeHtml(game.genre)}</span>` : ''}
                    </div>
                </div>
            `).join('');
        }

        // ë‚ ì§œ í¬ë§·
        function formatDate(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            return `${date.getFullYear()}.${String(date.getMonth() + 1).padStart(2, '0')}.${String(date.getDate()).padStart(2, '0')}`;
        }

        // HTML ì´ìŠ¤ì¼€ì´í”„
        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>
