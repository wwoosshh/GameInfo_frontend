<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë²„ì „ ìƒì„¸ - GameInfo</title>
    <link rel="stylesheet" href="../css/main.css">
    <style>
        /* ë²„ì „ í—¤ë” - ë¯¸ë‹ˆë©€ ë‹¤í¬ */
        .version-hero {
            padding: 48px 0;
            margin-bottom: 32px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .version-hero-content {
            position: relative;
        }

        .version-number {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 8px;
            color: #e6e6e6;
            letter-spacing: -0.03em;
        }

        .version-name {
            font-size: 18px;
            color: #9ca3af;
            margin-bottom: 16px;
        }

        .version-meta {
            display: flex;
            gap: 20px;
            margin-top: 16px;
            flex-wrap: wrap;
        }

        .meta-item {
            font-size: 14px;
            color: #9ca3af;
        }

        .current-badge {
            background: #60a5fa;
            color: #0a0e14;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }

        /* ì¹´í…Œê³ ë¦¬ ì„¹ì…˜ - ë¦¬ìŠ¤íŠ¸ í˜•íƒœ */
        .category-section {
            margin-bottom: 48px;
        }

        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .category-title {
            font-size: 20px;
            font-weight: 600;
            color: #e6e6e6;
            letter-spacing: -0.02em;
        }

        .category-count {
            background: #1a1f26;
            color: #9ca3af;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 13px;
            font-weight: 500;
        }

        /* ì•„ì´í…œ ë¦¬ìŠ¤íŠ¸ - ê²½ê³„ ëª¨í˜¸í•œ ë””ìì¸ */
        .items-grid {
            display: flex;
            flex-direction: column;
            gap: 0;
        }

        /* ê°„ë‹¨í•œ í•­ëª©ìš© ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ */
        .items-grid-compact {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 16px;
        }

        .item-card {
            display: flex;
            gap: 16px;
            padding: 24px 0;
            transition: all 0.2s ease;
        }

        .item-card:not(:last-child) {
            border-bottom: 1px solid rgba(255, 255, 255, 0.03);
        }

        .item-card:hover {
            background-color: rgba(26, 31, 38, 0.3);
            padding-left: 16px;
            padding-right: 16px;
            margin-left: -16px;
            margin-right: -16px;
            border-radius: 8px;
        }

        /* ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒìš© ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .items-grid-compact .item-card {
            padding: 16px;
            border: none;
            background: rgba(26, 31, 38, 0.2);
            border-radius: 8px;
            margin: 0;
        }

        .items-grid-compact .item-card:hover {
            background-color: rgba(26, 31, 38, 0.5);
            padding: 16px;
            margin: 0;
        }

        .item-thumbnail {
            width: 72px;
            height: 72px;
            background: rgba(26, 31, 38, 0.5);
            border-radius: 8px;
            object-fit: cover;
            flex-shrink: 0;
        }

        /* ê°„ë‹¨í•œ í•­ëª©ì€ ì‘ì€ ì¸ë„¤ì¼ */
        .items-grid-compact .item-thumbnail {
            width: 56px;
            height: 56px;
        }

        /* ë³µì¡í•œ í•­ëª©ì€ í° ì¸ë„¤ì¼ */
        .item-card-detailed .item-thumbnail {
            width: 88px;
            height: 88px;
        }

        .item-content {
            flex: 1;
            min-width: 0;
        }

        .item-header {
            margin-bottom: 12px;
        }

        .item-title {
            font-size: 16px;
            font-weight: 600;
            color: #e6e6e6;
            margin-bottom: 4px;
            letter-spacing: -0.01em;
            line-height: 1.4;
        }

        .item-subtitle {
            font-size: 13px;
            color: #9ca3af;
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .item-badges {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            margin-bottom: 12px;
        }

        .badge {
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 11px;
            font-weight: 500;
        }

        /* ê°„ë‹¨í•œ í•­ëª©ì€ ë” ì‘ì€ íƒ€ì´í‹€ */
        .items-grid-compact .item-title {
            font-size: 15px;
            margin-bottom: 6px;
        }

        .items-grid-compact .item-badges {
            margin-bottom: 0;
        }

        /* ë³µì¡í•œ í•­ëª©ì€ ì•½ê°„ í° íƒ€ì´í‹€ */
        .item-card-detailed .item-title {
            font-size: 18px;
        }

        .badge-rarity { background: rgba(147, 51, 234, 0.15); color: #a78bfa; }
        .badge-element { background: rgba(59, 130, 246, 0.15); color: #60a5fa; }
        .badge-path { background: rgba(16, 185, 129, 0.15); color: #34d399; }
        .badge-type { background: rgba(245, 158, 11, 0.15); color: #fbbf24; }
        .badge-featured { background: rgba(251, 191, 36, 0.15); color: #fbbf24; }

        .item-details {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .detail-row {
            display: flex;
            gap: 24px;
            flex-wrap: wrap;
        }

        .detail-item {
            display: flex;
            flex-direction: column;
            gap: 3px;
        }

        .detail-label {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #6b7280;
            font-weight: 500;
        }

        .detail-value {
            font-size: 13px;
            color: #e6e6e6;
            line-height: 1.5;
        }

        .detail-value-secondary {
            font-size: 13px;
            color: #9ca3af;
            line-height: 1.5;
        }

        .detail-section {
            margin-top: 12px;
            padding-top: 0;
        }

        .detail-section:first-child {
            margin-top: 0;
            padding-top: 0;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 12px;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            gap: 3px;
        }

        /* ê°„ë‹¨í•œ í•­ëª©ì€ detailsë¥¼ ë” ì‘ê²Œ */
        .items-grid-compact .item-details {
            gap: 4px;
        }

        .items-grid-compact .detail-value,
        .items-grid-compact .detail-value-secondary {
            font-size: 12px;
        }

        .empty-category {
            text-align: center;
            padding: 48px 24px;
            color: #6b7280;
        }

        /* ë’¤ë¡œê°€ê¸° ë²„íŠ¼ */
        .back-button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: transparent;
            color: #9ca3af;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.2s;
            margin-bottom: 32px;
            font-size: 14px;
        }

        .back-button:hover {
            background: #1a1f26;
            color: #e6e6e6;
        }

        /* ê´€ë¦¬ì ì•¡ì…˜ */
        .admin-actions {
            position: fixed;
            bottom: 32px;
            right: 32px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .admin-btn {
            padding: 12px 20px;
            border-radius: 6px;
            border: none;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
        }

        .admin-btn-primary {
            background: #60a5fa;
            color: #0a0e14;
        }

        .admin-btn-primary:hover {
            background: #3b82f6;
        }

        .admin-btn-success {
            background: #34d399;
            color: #0a0e14;
        }

        .admin-btn-success:hover {
            background: #10b981;
        }
    </style>
</head>
<body>
    <header class="main-header">
        <div class="container">
            <div class="header-content">
                <h1 class="site-title">
                    <a href="index.html">GameInfo</a>
                </h1>
                <nav class="main-nav">
                    <ul>
                        <li><a href="index.html">í™ˆ</a></li>
                        <li><a href="calendar.html">ìº˜ë¦°ë”</a></li>
                        <li><a href="games.html">ê²Œì„ ëª©ë¡</a></li>
                        <li><a href="ai_chat.html">AI ì±„íŒ…</a></li>
                        <li><a href="login.html" id="nav-login">ë¡œê·¸ì¸</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <main class="main-content">
        <div class="container">
            <a href="javascript:history.back()" class="back-button">
                â† ë’¤ë¡œ ê°€ê¸°
            </a>

            <div id="version-detail-container">
                <div class="loading">ë²„ì „ ì •ë³´ ë¡œë”© ì¤‘...</div>
            </div>
        </div>
    </main>

    <div class="admin-actions" id="admin-actions" style="display: none;">
        <button class="admin-btn admin-btn-success" onclick="goToAddItem()">+ í•­ëª© ì¶”ê°€</button>
        <button class="admin-btn admin-btn-primary" onclick="goToEditVersion()">ë²„ì „ ìˆ˜ì •</button>
    </div>

    <footer class="main-footer">
        <div class="container">
            <p>&copy; 2025 GameInfo. ëŒ€í•™êµ ê³¼ì œ í”„ë¡œì íŠ¸</p>
            <p>ëª¨ë“  ê²Œì„ ê´€ë ¨ ìƒí‘œëŠ” í•´ë‹¹ ì†Œìœ ìì˜ ìì‚°ì…ë‹ˆë‹¤.</p>
        </div>
    </footer>

    <script src="../js/api.js"></script>
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const versionId = urlParams.get('version_id');

        if (!versionId) {
            alert('ë²„ì „ IDê°€ í•„ìš”í•©ë‹ˆë‹¤.');
            window.location.href = 'index.html';
        }

        let versionData = null;
        let itemsData = null;

        // ì¹´í…Œê³ ë¦¬ í•œê¸€ ì´ë¦„
        const categoryInfo = {
            'new_field': { name: 'ì‹ ê·œ í•„ë“œ' },
            'new_path': { name: 'ì‹ ê·œ ìš´ëª…ì˜ ê¸¸' },
            'new_character': { name: 'ì‹ ê·œ ìºë¦­í„°' },
            'rerun_character': { name: 'ë³µê° ìºë¦­í„°' },
            'new_lightcone': { name: 'ì‹ ê·œ ê´‘ì¶”' },
            'rerun_lightcone': { name: 'ë³µê° ê´‘ì¶”' },
            'new_relic': { name: 'ì‹ ê·œ ìœ ë¬¼' },
            'new_trailblaze': { name: 'ì‹ ê·œ ê°œì²™ ì„ë¬´' },
            'new_companion': { name: 'ì‹ ê·œ ë™í–‰ ì„ë¬´' },
            'new_adventure': { name: 'ì‹ ê·œ ëª¨í—˜ ì„ë¬´' },
            'new_costume': { name: 'ì‹ ê·œ ì½”ìŠ¤íŠ¬' },
            'new_event': { name: 'ì‹ ê·œ ì´ë²¤íŠ¸' },
            'support_event': { name: 'í˜œíƒ ë° ìœ¡ì„± ì§€ì›' },
            'new_content': { name: 'ì‹ ê·œ ì½˜í…ì¸ ' },
            'new_enemy': { name: 'ì‹ ê·œ ì ' },
            'new_material': { name: 'ì‹ ê·œ ì¬ë£Œ' },
            'convenience': { name: 'í¸ì˜ì„± ì—…ë°ì´íŠ¸' },
            'other': { name: 'ê¸°íƒ€' }
        };

        // í˜ì´ì§€ ì´ˆê¸°í™”
        async function initPage() {
            checkUserAuth();
            await loadVersionDetail();
            await loadVersionItems();
            renderPage();
        }

        // ì‚¬ìš©ì ì¸ì¦ í™•ì¸
        function checkUserAuth() {
            const userStr = localStorage.getItem('user');
            if (userStr) {
                const user = JSON.parse(userStr);
                document.getElementById('nav-login').textContent = user.display_name;
                document.getElementById('nav-login').href = 'javascript:logout()';

                // ê´€ë¦¬ìë©´ ê´€ë¦¬ ë²„íŠ¼ í‘œì‹œ
                if (user.is_admin) {
                    document.getElementById('admin-actions').style.display = 'flex';
                }
            }
        }

        // ë¡œê·¸ì•„ì›ƒ
        async function logout() {
            await API.user.logout();
        }

        // ë²„ì „ ìƒì„¸ ë¡œë“œ
        async function loadVersionDetail() {
            try {
                const response = await API.versions.getById(versionId);
                versionData = response.data;
            } catch (error) {
                console.error('Failed to load version detail:', error);
                document.getElementById('version-detail-container').innerHTML =
                    '<div class="error-message">ë²„ì „ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
            }
        }

        // ë²„ì „ í•­ëª© ë¡œë“œ
        async function loadVersionItems() {
            try {
                const response = await API.versions.getItems(versionId);
                itemsData = response.data;
            } catch (error) {
                console.error('Failed to load version items:', error);
            }
        }

        // í˜ì´ì§€ ë Œë”ë§
        function renderPage() {
            if (!versionData) return;

            const container = document.getElementById('version-detail-container');

            // ë²„ì „ íˆì–´ë¡œ
            const heroHTML = `
                <div class="version-hero">
                    <div class="version-hero-content">
                        <div class="version-number">ë²„ì „ ${escapeHtml(versionData.version_number)}</div>
                        <div class="version-name">${escapeHtml(versionData.version_name || '')}</div>
                        <div class="version-meta">
                            <div class="meta-item">${formatDate(versionData.release_date)}</div>
                            ${versionData.duration_days ? `<div class="meta-item">${versionData.duration_days}ì¼ê°„</div>` : ''}
                            ${versionData.is_current == 1 ? `<div class="meta-item"><span class="current-badge">í˜„ì¬ ë²„ì „</span></div>` : ''}
                        </div>
                    </div>
                </div>
            `;

            // ì¹´í…Œê³ ë¦¬ë³„ í•­ëª©
            let categoriesHTML = '';
            if (itemsData && itemsData.grouped) {
                for (const [category, items] of Object.entries(itemsData.grouped)) {
                    const catInfo = categoryInfo[category] || { name: category, icon: 'ğŸ“Œ' };
                    categoriesHTML += renderCategory(category, catInfo, items);
                }
            }

            if (!categoriesHTML) {
                categoriesHTML = '<div class="empty-category">ë“±ë¡ëœ ì—…ë°ì´íŠ¸ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
            }

            container.innerHTML = heroHTML + categoriesHTML;
        }

        // ì¹´í…Œê³ ë¦¬ ë Œë”ë§
        function renderCategory(category, catInfo, items) {
            const itemsHTML = items.map(item => renderItem(category, item)).join('');

            // ê°„ë‹¨í•œ í•­ëª©ì€ ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ ì‚¬ìš©
            const compactCategories = ['new_field', 'new_path', 'new_costume', 'convenience', 'other'];
            const isCompact = compactCategories.includes(category);
            const gridClass = isCompact ? 'items-grid-compact' : 'items-grid';

            return `
                <div class="category-section">
                    <div class="category-header">
                        <div class="category-title">${catInfo.name}</div>
                        <span class="category-count">${items.length}ê°œ</span>
                    </div>
                    <div class="${gridClass}">
                        ${itemsHTML}
                    </div>
                </div>
            `;
        }

        // ì•„ì´í…œ ë Œë”ë§ (ì¹´í…Œê³ ë¦¬ë³„ ë¶„ê¸°)
        function renderItem(category, item) {
            const data = item.additional_data ? JSON.parse(item.additional_data) : {};
            const imageUrl = data.image_url || item.image_url || '';

            switch(category) {
                case 'new_character':
                case 'rerun_character':
                    return renderCharacter(item, data, imageUrl);
                case 'new_lightcone':
                case 'rerun_lightcone':
                    return renderLightcone(item, data, imageUrl);
                case 'new_relic':
                    return renderRelic(item, data, imageUrl);
                case 'new_field':
                    return renderField(item, data, imageUrl);
                case 'new_path':
                    return renderPath(item, data, imageUrl);
                case 'new_trailblaze':
                case 'new_companion':
                case 'new_adventure':
                    return renderMission(item, data, imageUrl);
                case 'new_costume':
                    return renderCostume(item, data, imageUrl);
                case 'new_event':
                    return renderEvent(item, data, imageUrl);
                case 'support_event':
                    return renderSupportEvent(item, data, imageUrl);
                case 'new_content':
                    return renderContent(item, data, imageUrl);
                case 'new_enemy':
                    return renderEnemy(item, data, imageUrl);
                case 'new_material':
                    return renderMaterial(item, data, imageUrl);
                case 'convenience':
                case 'other':
                    return renderSimple(item, data, imageUrl);
                default:
                    return renderSimple(item, data, imageUrl);
            }
        }

        // ìºë¦­í„° ë Œë”ë§
        function renderCharacter(item, data, imageUrl) {
            const name = data.name || item.item_name;
            const badges = [];
            if (data.rarity) badges.push(`<span class="badge badge-rarity">${data.rarity}</span>`);
            if (data.element) badges.push(`<span class="badge badge-element">${data.element}</span>`);
            if (data.path) badges.push(`<span class="badge badge-path">${data.path}</span>`);

            const languageNames = [];
            if (data.name_ko) languageNames.push(`<div class="detail-item"><div class="detail-label">í•œêµ­ì–´</div><div class="detail-value-secondary">${escapeHtml(data.name_ko)}</div></div>`);
            if (data.name_en) languageNames.push(`<div class="detail-item"><div class="detail-label">English</div><div class="detail-value-secondary">${escapeHtml(data.name_en)}</div></div>`);
            if (data.name_cn) languageNames.push(`<div class="detail-item"><div class="detail-label">ä¸­æ–‡</div><div class="detail-value-secondary">${escapeHtml(data.name_cn)}</div></div>`);
            if (data.name_jp) languageNames.push(`<div class="detail-item"><div class="detail-label">æ—¥æœ¬èª</div><div class="detail-value-secondary">${escapeHtml(data.name_jp)}</div></div>`);

            const voiceActors = [];
            if (data.voice_actor_ko) voiceActors.push(`<div class="detail-item"><div class="detail-label">í•œêµ­</div><div class="detail-value-secondary">${escapeHtml(data.voice_actor_ko)}</div></div>`);
            if (data.voice_actor_en) voiceActors.push(`<div class="detail-item"><div class="detail-label">English</div><div class="detail-value-secondary">${escapeHtml(data.voice_actor_en)}</div></div>`);
            if (data.voice_actor_cn) voiceActors.push(`<div class="detail-item"><div class="detail-label">ä¸­æ–‡</div><div class="detail-value-secondary">${escapeHtml(data.voice_actor_cn)}</div></div>`);
            if (data.voice_actor_jp) voiceActors.push(`<div class="detail-item"><div class="detail-label">æ—¥æœ¬èª</div><div class="detail-value-secondary">${escapeHtml(data.voice_actor_jp)}</div></div>`);

            return `
                <div class="item-card item-card-detailed">
                    ${imageUrl ? `<img src="${escapeHtml(imageUrl)}" alt="${escapeHtml(name)}" class="item-thumbnail">` : '<div class="item-thumbnail"></div>'}
                    <div class="item-content">
                        <div class="item-header">
                            <div class="item-title">${escapeHtml(name)}</div>
                            ${data.nickname ? `<div class="item-subtitle">${escapeHtml(data.nickname)}</div>` : ''}
                            ${badges.length > 0 ? `<div class="item-badges">${badges.join('')}</div>` : ''}
                        </div>
                        <div class="item-details">
                            ${data.gender || data.affiliation ? `
                                <div class="detail-row">
                                    ${data.gender ? `<div class="detail-item"><div class="detail-label">ì„±ë³„</div><div class="detail-value">${escapeHtml(data.gender)}</div></div>` : ''}
                                    ${data.affiliation ? `<div class="detail-item"><div class="detail-label">ì†Œì†</div><div class="detail-value">${escapeHtml(data.affiliation)}</div></div>` : ''}
                                </div>
                            ` : ''}
                            ${languageNames.length > 0 ? `
                                <div class="detail-section">
                                    <div class="detail-row">${languageNames.join('')}</div>
                                </div>
                            ` : ''}
                            ${voiceActors.length > 0 ? `
                                <div class="detail-section">
                                    <div class="detail-label" style="margin-bottom: 8px;">ì„±ìš°</div>
                                    <div class="detail-row">${voiceActors.join('')}</div>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `;
        }

        // ê´‘ì¶” ë Œë”ë§
        function renderLightcone(item, data, imageUrl) {
            const name = data.name || item.item_name;
            const badges = [];
            if (data.rarity) badges.push(`<span class="badge badge-rarity">${data.rarity}</span>`);
            if (data.path) badges.push(`<span class="badge badge-path">${data.path}</span>`);

            const stats = [];
            if (data.base_hp) stats.push(`<div class="stat-item"><div class="detail-label">ê¸°ë³¸ HP</div><div class="detail-value">${data.base_hp}</div></div>`);
            if (data.base_atk) stats.push(`<div class="stat-item"><div class="detail-label">ê¸°ë³¸ ê³µê²©ë ¥</div><div class="detail-value">${data.base_atk}</div></div>`);
            if (data.base_def) stats.push(`<div class="stat-item"><div class="detail-label">ê¸°ë³¸ ë°©ì–´ë ¥</div><div class="detail-value">${data.base_def}</div></div>`);

            return `
                <div class="item-card item-card-detailed">
                    ${imageUrl ? `<img src="${escapeHtml(imageUrl)}" alt="${escapeHtml(name)}" class="item-thumbnail">` : '<div class="item-thumbnail"></div>'}
                    <div class="item-content">
                        <div class="item-header">
                            <div class="item-title">${escapeHtml(name)}</div>
                            ${badges.length > 0 ? `<div class="item-badges">${badges.join('')}</div>` : ''}
                        </div>
                        <div class="item-details">
                            ${stats.length > 0 ? `<div class="stats-grid">${stats.join('')}</div>` : ''}
                            ${data.skill_name ? `
                                <div class="detail-section">
                                    <div class="detail-item">
                                        <div class="detail-label">ê´‘ì¶” ìŠ¤í‚¬</div>
                                        <div class="detail-value">${escapeHtml(data.skill_name)}</div>
                                    </div>
                                </div>
                            ` : ''}
                            ${data.skill_description ? `
                                <div class="detail-item">
                                    <div class="detail-value-secondary">${escapeHtml(data.skill_description)}</div>
                                </div>
                            ` : ''}
                            ${data.acquisition_method ? `
                                <div class="detail-section">
                                    <div class="detail-item">
                                        <div class="detail-label">íšë“ ê²½ë¡œ</div>
                                        <div class="detail-value">${escapeHtml(data.acquisition_method)}</div>
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `;
        }

        // ìœ ë¬¼ ë Œë”ë§
        function renderRelic(item, data, imageUrl) {
            const name = data.name || item.item_name;
            const badges = [];
            if (data.type) badges.push(`<span class="badge badge-type">${data.type}</span>`);

            return `
                <div class="item-card item-card-detailed">
                    ${imageUrl ? `<img src="${escapeHtml(imageUrl)}" alt="${escapeHtml(name)}" class="item-thumbnail">` : '<div class="item-thumbnail"></div>'}
                    <div class="item-content">
                        <div class="item-header">
                            <div class="item-title">${escapeHtml(name)}</div>
                            ${badges.length > 0 ? `<div class="item-badges">${badges.join('')}</div>` : ''}
                        </div>
                        <div class="item-details">
                            ${data.set_2pc_effect ? `
                                <div class="detail-item">
                                    <div class="detail-label">2ì„¸íŠ¸ íš¨ê³¼</div>
                                    <div class="detail-value">${escapeHtml(data.set_2pc_effect)}</div>
                                </div>
                            ` : ''}
                            ${data.set_4pc_effect ? `
                                <div class="detail-item">
                                    <div class="detail-label">4ì„¸íŠ¸ íš¨ê³¼</div>
                                    <div class="detail-value">${escapeHtml(data.set_4pc_effect)}</div>
                                </div>
                            ` : ''}
                            ${data.acquisition_method ? `
                                <div class="detail-section">
                                    <div class="detail-item">
                                        <div class="detail-label">íšë“ì²˜</div>
                                        <div class="detail-value-secondary">${escapeHtml(data.acquisition_method)}</div>
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `;
        }

        // í•„ë“œ ë Œë”ë§
        function renderField(item, data, imageUrl) {
            const name = data.name || item.item_name;
            const badges = [];
            if (data.region) badges.push(`<span class="badge badge-element">${data.region}</span>`);
            if (data.sub_region) badges.push(`<span class="badge badge-type">${data.sub_region}</span>`);

            return `
                <div class="item-card">
                    ${imageUrl ? `<img src="${escapeHtml(imageUrl)}" alt="${escapeHtml(name)}" class="item-thumbnail">` : '<div class="item-thumbnail"></div>'}
                    <div class="item-content">
                        <div class="item-title">${escapeHtml(name)}</div>
                        ${data.name_en ? `<div class="item-subtitle">${escapeHtml(data.name_en)}</div>` : ''}
                        ${badges.length > 0 ? `<div class="item-badges">${badges.join('')}</div>` : ''}
                    </div>
                </div>
            `;
        }

        // ìš´ëª…ì˜ ê¸¸ ë Œë”ë§
        function renderPath(item, data, imageUrl) {
            const name = data.name || item.item_name;
            const badges = [];
            if (data.role) badges.push(`<span class="badge badge-path">${data.role}</span>`);
            if (data.taunt_value) badges.push(`<span class="badge badge-type">ë„ë°œ ${data.taunt_value}</span>`);

            return `
                <div class="item-card">
                    ${imageUrl ? `<img src="${escapeHtml(imageUrl)}" alt="${escapeHtml(name)}" class="item-thumbnail">` : '<div class="item-thumbnail"></div>'}
                    <div class="item-content">
                        <div class="item-title">${escapeHtml(name)}</div>
                        ${badges.length > 0 ? `<div class="item-badges">${badges.join('')}</div>` : ''}
                        ${data.characteristics ? `<div class="detail-value-secondary" style="margin-top: 4px;">${escapeHtml(data.characteristics)}</div>` : ''}
                    </div>
                </div>
            `;
        }

        // ì„ë¬´ ë Œë”ë§
        function renderMission(item, data, imageUrl) {
            const name = data.name || item.item_name;
            const badges = [];
            if (data.chapter_number) badges.push(`<span class="badge badge-type">${data.chapter_number}</span>`);

            return `
                <div class="item-card">
                    ${imageUrl ? `<img src="${escapeHtml(imageUrl)}" alt="${escapeHtml(name)}" class="item-thumbnail">` : '<div class="item-thumbnail"></div>'}
                    <div class="item-content">
                        <div class="item-header">
                            <div class="item-title">${escapeHtml(name)}</div>
                            ${data.subtitle ? `<div class="item-subtitle">${escapeHtml(data.subtitle)}</div>` : ''}
                            ${badges.length > 0 ? `<div class="item-badges">${badges.join('')}</div>` : ''}
                        </div>
                        <div class="item-details">
                            ${data.unlock_condition ? `
                                <div class="detail-item">
                                    <div class="detail-label">ê°œë°© ì¡°ê±´</div>
                                    <div class="detail-value-secondary">${escapeHtml(data.unlock_condition)}</div>
                                </div>
                            ` : ''}
                            ${data.description ? `
                                <div class="detail-item">
                                    <div class="detail-value-secondary">${escapeHtml(data.description)}</div>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `;
        }

        // ì½”ìŠ¤íŠ¬ ë Œë”ë§
        function renderCostume(item, data, imageUrl) {
            const name = data.name || item.item_name;

            return `
                <div class="item-card">
                    ${imageUrl ? `<img src="${escapeHtml(imageUrl)}" alt="${escapeHtml(name)}" class="item-thumbnail">` : '<div class="item-thumbnail"></div>'}
                    <div class="item-content">
                        <div class="item-title">${escapeHtml(name)}</div>
                        ${data.character_name ? `<div class="item-subtitle">${escapeHtml(data.character_name)}</div>` : ''}
                        ${data.acquisition_method ? `<div class="detail-value-secondary" style="margin-top: 4px;">${escapeHtml(data.acquisition_method)}</div>` : ''}
                    </div>
                </div>
            `;
        }

        // ì´ë²¤íŠ¸ ë Œë”ë§
        function renderEvent(item, data, imageUrl) {
            const name = data.name || item.item_name;
            const badges = [];
            if (data.event_type) badges.push(`<span class="badge badge-type">${data.event_type}</span>`);

            return `
                <div class="item-card">
                    ${imageUrl ? `<img src="${escapeHtml(imageUrl)}" alt="${escapeHtml(name)}" class="item-thumbnail">` : '<div class="item-thumbnail"></div>'}
                    <div class="item-content">
                        <div class="item-header">
                            <div class="item-title">${escapeHtml(name)}</div>
                            ${badges.length > 0 ? `<div class="item-badges">${badges.join('')}</div>` : ''}
                        </div>
                        <div class="item-details">
                            ${data.description ? `<div class="detail-value-secondary">${escapeHtml(data.description)}</div>` : ''}
                            ${data.rewards ? `
                                <div class="detail-section">
                                    <div class="detail-item">
                                        <div class="detail-label">ë³´ìƒ</div>
                                        <div class="detail-value">${escapeHtml(data.rewards)}</div>
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `;
        }

        // ì§€ì› ì´ë²¤íŠ¸ ë Œë”ë§
        function renderSupportEvent(item, data, imageUrl) {
            const name = data.name || item.item_name;
            const badges = [];
            if (data.duration) badges.push(`<span class="badge badge-type">${data.duration}</span>`);

            return `
                <div class="item-card">
                    ${imageUrl ? `<img src="${escapeHtml(imageUrl)}" alt="${escapeHtml(name)}" class="item-thumbnail">` : '<div class="item-thumbnail"></div>'}
                    <div class="item-content">
                        <div class="item-header">
                            <div class="item-title">${escapeHtml(name)}</div>
                            ${data.support_type ? `<div class="item-subtitle">${escapeHtml(data.support_type)}</div>` : ''}
                            ${badges.length > 0 ? `<div class="item-badges">${badges.join('')}</div>` : ''}
                        </div>
                        ${data.description ? `
                            <div class="item-details">
                                <div class="detail-value-secondary">${escapeHtml(data.description)}</div>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        // ì½˜í…ì¸  ë Œë”ë§
        function renderContent(item, data, imageUrl) {
            const name = data.name || item.item_name;
            const badges = [];
            if (data.content_type) badges.push(`<span class="badge badge-type">${data.content_type}</span>`);

            return `
                <div class="item-card">
                    ${imageUrl ? `<img src="${escapeHtml(imageUrl)}" alt="${escapeHtml(name)}" class="item-thumbnail">` : '<div class="item-thumbnail"></div>'}
                    <div class="item-content">
                        <div class="item-header">
                            <div class="item-title">${escapeHtml(name)}</div>
                            ${badges.length > 0 ? `<div class="item-badges">${badges.join('')}</div>` : ''}
                        </div>
                        ${data.description ? `
                            <div class="item-details">
                                <div class="detail-value-secondary">${escapeHtml(data.description)}</div>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        // ì  ë Œë”ë§
        function renderEnemy(item, data, imageUrl) {
            const name = data.name || item.item_name;
            const badges = [];
            if (data.element_weakness) {
                const weakness = Array.isArray(data.element_weakness)
                    ? data.element_weakness.join(', ')
                    : data.element_weakness;
                badges.push(`<span class="badge badge-element">ì•½ì : ${weakness}</span>`);
            }

            return `
                <div class="item-card item-card-detailed">
                    ${imageUrl ? `<img src="${escapeHtml(imageUrl)}" alt="${escapeHtml(name)}" class="item-thumbnail">` : '<div class="item-thumbnail"></div>'}
                    <div class="item-content">
                        <div class="item-header">
                            <div class="item-title">${escapeHtml(name)}</div>
                            ${data.nickname ? `<div class="item-subtitle">${escapeHtml(data.nickname)}</div>` : ''}
                            ${badges.length > 0 ? `<div class="item-badges">${badges.join('')}</div>` : ''}
                        </div>
                        <div class="item-details">
                            ${data.affiliation ? `
                                <div class="detail-item">
                                    <div class="detail-label">ì†Œì†</div>
                                    <div class="detail-value">${escapeHtml(data.affiliation)}</div>
                                </div>
                            ` : ''}
                            ${data.description ? `
                                <div class="detail-value-secondary">${escapeHtml(data.description)}</div>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `;
        }

        // ì¬ë£Œ ë Œë”ë§
        function renderMaterial(item, data, imageUrl) {
            const name = data.name || item.item_name;
            const badges = [];
            if (data.rarity) badges.push(`<span class="badge badge-rarity">${data.rarity}</span>`);
            if (data.usage) badges.push(`<span class="badge badge-type">${data.usage}</span>`);

            return `
                <div class="item-card">
                    ${imageUrl ? `<img src="${escapeHtml(imageUrl)}" alt="${escapeHtml(name)}" class="item-thumbnail">` : '<div class="item-thumbnail"></div>'}
                    <div class="item-content">
                        <div class="item-header">
                            <div class="item-title">${escapeHtml(name)}</div>
                            ${badges.length > 0 ? `<div class="item-badges">${badges.join('')}</div>` : ''}
                        </div>
                        <div class="item-details">
                            ${data.description ? `<div class="detail-value-secondary">${escapeHtml(data.description)}</div>` : ''}
                            <div class="detail-row">
                                ${data.acquisition_method ? `<div class="detail-item"><div class="detail-label">íšë“ ê²½ë¡œ</div><div class="detail-value-secondary">${escapeHtml(data.acquisition_method)}</div></div>` : ''}
                                ${data.used_by_characters ? `<div class="detail-item"><div class="detail-label">ì‚¬ìš© ìºë¦­í„°</div><div class="detail-value-secondary">${escapeHtml(data.used_by_characters)}</div></div>` : ''}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // ê°„ë‹¨í•œ í•­ëª© ë Œë”ë§ (í¸ì˜ì„±, ê¸°íƒ€)
        function renderSimple(item, data, imageUrl) {
            const name = data.title || data.name || item.item_name;

            return `
                <div class="item-card">
                    ${imageUrl ? `<img src="${escapeHtml(imageUrl)}" alt="${escapeHtml(name)}" class="item-thumbnail">` : '<div class="item-thumbnail"></div>'}
                    <div class="item-content">
                        <div class="item-title">${escapeHtml(name)}</div>
                        ${data.description ? `<div class="detail-value-secondary" style="margin-top: 4px;">${escapeHtml(data.description)}</div>` : ''}
                    </div>
                </div>
            `;
        }

        // ê´€ë¦¬ì ê¸°ëŠ¥
        function goToAddItem() {
            window.location.href = `admin.html?action=add_item&version_id=${versionId}`;
        }

        function goToEditVersion() {
            window.location.href = `admin.html?action=edit_version&version_id=${versionId}`;
        }

        // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
        function formatDate(dateString) {
            const date = new Date(dateString);
            return `${date.getFullYear()}ë…„ ${date.getMonth() + 1}ì›” ${date.getDate()}ì¼`;
        }

        function escapeHtml(text) {
            if (!text) return '';
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.toString().replace(/[&<>"']/g, m => map[m]);
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', initPage);
    </script>
</body>
</html>
